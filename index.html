<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upscale Image with Canvas-Sketch and Fabric.js</title>
</head>
<body>
    <input type="file" id="fileInput" accept="image/jpeg">
    <button id="upscaleButton">Upscale Image 4x</button>
    <canvas id="canvas" style="display:none;"></canvas>
    <img id="outputImage" style="display:none;">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.6.0/fabric.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-sketch@0.3.0/dist/canvas-sketch.min.js"></script>
    <script>
        document.getElementById('upscaleButton').addEventListener('click', function() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function() {
                        const canvas = new fabric.Canvas('canvas');
                        canvas.setWidth(img.width);
                        canvas.setHeight(img.height);

                        const fabricImg = new fabric.Image(img, {
                            left: 0,
                            top: 0,
                            selectable: false
                        });
                        canvas.add(fabricImg);

                        // Upscale the image 4x
                        const scaleFactor = 4;
                        fabricImg.scaleX = scaleFactor;
                        fabricImg.scaleY = scaleFactor;
                        canvas.renderAll();

                        // Create a new canvas for the upscaled image
                        const upscaledCanvas = document.createElement('canvas');
                        upscaledCanvas.width = img.width * scaleFactor;
                        upscaledCanvas.height = img.height * scaleFactor;
                        const upscaledCtx = upscaledCanvas.getContext('2d');

                        // Draw the upscaled image on the new canvas
                        upscaledCtx.drawImage(canvas.toDataURL(), 0, 0);

                        // Create a new image element to display the upscaled image
                        const outputImage = document.getElementById('outputImage');
                        outputImage.src = upscaledCanvas.toDataURL();
                        outputImage.style.display = 'block';
                    };
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>
